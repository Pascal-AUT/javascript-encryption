<!doctype html>
<html lang="en">
  <head>
   
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    
    <title>JavaScript Encryption</title>
    
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    
    <style>
      
      body { background: #e9ecef; }
      
      #public-key-input,
      #private-key-input,
      #aes-key-input,
      #aes-iv-input,
      #message-cypher { font-family: monospace; }
      
      #message-cypher,
      #message-plain { height: 200px; }
      
      .jumbotron { margin-bottom: 0; padding-bottom: 10px; }
      
      section { padding: 2rem; }
      textarea { resize: none; }
      
      main { background: #fff; border-bottom: 1px solid #ddd; }
      
      hr { border-color: #e9ecef; }
      
      nav { padding: 10px 0 30px; border-bottom: 1px solid #ddd; }
      
    </style>
    
  </head>
  <body>
    
    <header class="jumbotron">
      <div class="container">
        <div class="row">
          <div class="col">
            <h1 class="display-4">JavaScript Encryption</h1>
            <p class="lead">A utility page for encrypting and decrypting text. Experimenting with encryption and decryption using different JavaScript encryption libraries.</p>
          </div>
        </div>
       </div>
    </header>
    
    <nav class="nav">
      <div class="container">
        <div class="row">
          <div class="col-12">
            <ul class="nav nav-pills" id="myTab" role="tablist">
              <li class="nav-item">
                <a class="nav-link" id="rsa-tab" data-toggle="tab" href="#rsa" role="tab" aria-controls="rsa" aria-selected="false">RSA</a>
              </li>
              <li class="nav-item">
                <a class="nav-link active" id="aes-tab" data-toggle="tab" href="#aes" role="tab" aria-controls="aes" aria-selected="true">AES</a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </nav>

    <main class="tab-content" id="myTabContent">
  
      <section class="rsa tab-pane" id="rsa" role="tabpanel" aria-labelledby="home-tab">
        
        <div class="intro">
          <div class="container">
            <div class="row">
              <div class="col-12">
                
                <h3>RSA</h3>
                <p>Public key (asymmetric) encryption/decryption with RSA using <a href="https://github.com/travist/jsencrypt" target="_blank" rel="noopener">jsencrypt</a>.</p>
                
                <hr>
                
              </div>
            </div>
          </div>
        </div>
        
        <div class="keys">
          <div class="container">
            <div class="row">
              <div class="col-12">
                
              </div>
              <div class="col-6">     
                <div class="form-group">
                  <label for="public-key-input">Public Key</label>
                  <textarea class="form-control" name="public-key-input" id="public-key-input" cols="30" rows="10" placeholder="-----BEGIN PUBLIC KEY-----"></textarea>
                  <small class="form-text text-muted"></small>
                </div>
              </div>
              <div class="col-6">
                <div class="form-group">
                  <label for="private-key-input">Private Key</label>
                  <textarea class="form-control" name="private-key-input" id="private-key-input" cols="30" rows="10" placeholder="-----BEGIN RSA PRIVATE KEY-----"></textarea>
                  <small class="form-text text-muted"></small>
                </div>
              </div>
            </div>
          </div>
        </div>
        
      </section>
      
      <section class="tab-pane fade show active" id="aes" role="tabpanel" aria-labelledby="profile-tab">
        
        <div class="intro">
          <div class="container">
            <div class="row">
              <div class="col-12">
                
                <h3>AES - Counter</h3>
                <p>Encryption using the AES Counter mode of operation, utilizing <a href="https://github.com/ricmoo/aes-js" target="_blank" rel="noopener">aes-js</a>. Read more about the <a href="https://en.wikipedia.org/wiki/Block_cipher_mode_of_operation#Counter_(CTR)" target="_blank">Counter</a> mode of operation.</p>
                
                <hr>
                
              </div>
            </div>
          </div>
        </div>
        
        <div class="keys">
          <div class="container">
            <div class="row">
              <div class="col-12">
                
              </div>
              <div class="col-12">     
                <div class="form-group">
                  <label for="aes-key-input">Key</label>
                  <input class="form-control" name="aes-key-input" id="aes-key-input" cols="30" rows="5" placeholder="[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]" />
                  <small class="form-text text-muted">A random string of bits created explicitly for scrambling and unscrambling data as either 128-bit, 192-bit or 256-bit arrays. Use a sample key: <a href="#" class="sample-key" data-size="128">128-bit</a>, <a href="#" class="sample-key" data-size="192">192-bit</a>, or <a href="#" class="sample-key" data-size="256">256-bit</a>.</small>
                </div>
                <div class="form-group">
                  <label for="aes-counter">Counter</label>
                  <input type="text" class="form-control" name="aes-counter" id="aes-counter" placeholder="01234567">
                  <small class="form-text text-muted">Enter a specific number here to decrypt, or leave blank for randomly generated counter.</small>
                </div>
              </div>
            </div>
          </div>
        </div>
        
      </section>
  
    </main>
    
    <section class="workbench">
      <div class="container">
        <div class="row">
          <div class="col">
           <div class="form-group">
              <label for="message-input">Plaintext</label>
              <textarea class="form-control" name="message-input" id="message-plain" cols="30" rows="10" placeholder="The quick brown fox..."></textarea>
           </div>
           <button id="encrypt" class="btn btn-success">Encrypt</button>
          </div>
          <div class="col">
            <div class="form-group">
              <label for="message-result">Ciphertext</label>
              <textarea class="form-control" name="message-result" id="message-cypher" cols="30" rows="10"></textarea>
            </div>
            <button id="decrypt" class="btn btn-secondary float-right">Decrypt</button>
          </div>
        </div>
      </div>
    </section>  
    
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    
    <!-- START Encryption Libs -->
    <script src="vendor/jsencrypt.min.js"></script>
    <script src="vendor/aes-js.js"></script>
    <!-- END Encryption Libs -->
    
    <script>
      
      $(document).ready(function() {
        
        /**
         * Save Field Values to LocalStorage for sessionPersistance;
         * @type {Array}
         */
        let saveFields = ['aes-key-input', 'public-key-input', 'private-key-input', 'aes-counter'];
        
        for (var i = 0; i < saveFields.length; i++) {
        
          let $id = "#" + saveFields[i];
          let id = saveFields[i];
          
          $($id).val(window.localStorage.getItem(id));
          
          $($id).change(function() {

            window.localStorage.setItem(id, $(this).val());
            
          });
        
        }
        
        var counter;
        
        /**
         * Encrypt Handler
         */
        $("#encrypt").on('click', function() {
          
          var message = $('#message-plain').val();
          var currentTab = $(".nav-link.active").attr('aria-controls');
          var counter = $("#aes-counter").val();
          
          if (!counter) {
            
            counter = Math.floor(Math.random() * 1000000000);
            $("#aes-counter").val(counter);
            
          }
          
          if (message) {
            
            if (currentTab === 'aes') {
            
              var key = JSON.parse($("#aes-key-input").val());
              counter = JSON.parse($("#aes-counter").val());
              
              // Convert text to bytes
              var textBytes = aesjs.utils.utf8.toBytes(message);

              // The counter is optional, and if omitted will begin at 1
              var aesCtr = new aesjs.ModeOfOperation.ctr(key, new aesjs.Counter(counter));
              var encryptedBytes = aesCtr.encrypt(textBytes);

              // To print or store the binary data, you may convert it to hex
              var encryptedHex = aesjs.utils.hex.fromBytes(encryptedBytes);

              // When ready to decrypt the hex string, convert it back to bytes
              $("#message-plain").val("");
              $("#message-cypher").val(encryptedHex);
              $("#aes-counter").val(counter);
              
            
            } else if(currentTab === 'rsa'){
              
              var encrypt = new JSEncrypt();
                  encrypt.setPublicKey($('#public-key-input').val());
                  
                  $("#message-plain").val("");
                  $("#message-cypher").val(encrypt.encrypt(message));
              
            }
            
          }
          
        });
          
        /**
         * Decrypt Handler
         */  
        $("#decrypt").on('click', function() {  
            
            var ciphertext = $('#message-cypher').val();
            var currentTab = $(".nav-link.active").attr('aria-controls');
            
            if (ciphertext) {
            
              if (currentTab === 'aes') {
                
                var key = JSON.parse($("#aes-key-input").val());
                counter = JSON.parse($("#aes-counter").val());
                
                // When ready to decrypt the hex string, convert it back to bytes
                var encryptedBytes = aesjs.utils.hex.toBytes(ciphertext);
                
                // The counter mode of operation maintains internal state, so to
                // decrypt a new instance must be instantiated.
                var aesCtr = new aesjs.ModeOfOperation.ctr(key, new aesjs.Counter(counter));
                var decryptedBytes = aesCtr.decrypt(encryptedBytes);

                // Convert our bytes back into text
                var decryptedText = aesjs.utils.utf8.fromBytes(decryptedBytes);
                
                $("#message-cypher").val("");
                $("#message-plain").val(decryptedText);
                 
                                
              } else if(currentTab === 'rsa'){
                
                 // We're decrypting
                var decrypt = new JSEncrypt();
                    decrypt.setPrivateKey($('#private-key-input').val());
                
                response = decrypt.decrypt(ciphertext);
                
                $("#message-cypher").val("");
                $("#message-plain").val(response);
                
              }
            
            }
        
        });
        
        $(".sample-key").on('click', function(event) {
          event.preventDefault();
          
          $("#aes-key-input").val('');
          
          var keys = {
            
            "128": "[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]",
            "192": "[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23]",
            "256": "[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31]"
          }
          
          $("#aes-key-input").val(keys[$(this).data('size')]);
          
        });        
      });
      
    </script>
  </body>
</html>